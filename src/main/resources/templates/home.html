<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Donate when Trump Tweets</title>
    <meta th:name="_csrf" th:content="${_csrf.token}"/>
    <meta th:name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>
<h1 th:inline="text">Hello [[${#httpServletRequest.remoteUser}]]! Credit Card: [[${user.creditCard}]]</h1>
<form th:action="@{/logout}" method="post">
    <input type="submit" value="Sign Out"/>
</form>

<!-- Include PandaJS -->
<script src="//d2t45z63lq9zlh.cloudfront.net/panda-v0.0.5.min.js"></script>
<script
        src="https://code.jquery.com/jquery-3.1.1.min.js"
        integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
        crossorigin="anonymous"></script>


<form id="panda_cc_form">
    <div>
        <label>First Name</label>
        <input type="text" data-panda="first_name" value="Harry"/>
    </div>

    <div>
        <label>Last Name</label>
        <input type="text" data-panda="last_name" value="Potter"/>
    </div>

    <div>
        <label>Credit Card Number</label>
        <input type="text" id="credit_card" data-panda="credit_card" value="378282246310005"/>
    </div>

    <div>
        <label>Expiration</label>
        <input type="text" data-panda="expiration" value="05/2019"/>
    </div>

    <div>
        <label>CVV</label>
        <input type="text" data-panda="cvv" value="059"/>
    </div>

    <div id="tokenize">
        <button type="submit">Tokenize!</button>
    </div>
</form>

<script>
  // Call Panda.init() with your Panda Publishable Key and the DOM id of the
  // credit card-related form element

  Panda.init('pk_live_OXy1EHZX7H1EH-S4eaBKwg', 'panda_cc_form');

  Panda.on('success', function(cardToken) {
    // You now have a token you can use to refer to that credit card later.
    // This token is used in PandaPay API calls for creating donations and grants
    // so that you don't have to worry about security concerns with dealing with
    // credit card data.
    console.log(cardToken);

    $.ajax({
        url: '/payments',
        type: 'post',
        data: {"token":cardToken, "username":"jphil529", "lastfour":"5095"},
        headers: {
           "X-CSRF-TOKEN" : $("meta[name='_csrf']").attr("content")
        },
        dataType: 'json',
        success: function (data) {
            console.info(data);
        }
    });
  });

  Panda.on('error', function(errors) {
    // errors is a human-readable list of things that went wrong
    //  (invalid card number, missing last name, etc.)
    console.log(errors);
  });
</script>
</body>
</html>